<div class='header-div'>
    <div class='back-div'>
        <a class='back-a' [routerLink]="['/chat', 'conversations']">
            &lt; Back
        </a>           
    </div>
    <div class='profile-img-div'>
        <img [src]="recipientImgUrl" class='profile-img'
            onerror="this.src='/assets/user.png'">
    </div>
    <div class='user-name-div'>
        <a *ngIf="!conversationIsGroup" class='user-name-a' [routerLink]="['/profile', recipientId]">
            {{ recipientName }}
        </a>
        <span *ngIf="conversationIsGroup" style="font-size: 15px;">{{ conversationTitle }}</span>
        <span *ngIf="recipientPresence === undefined || recipientPresence === null"
            class="activity-hidden-span">
            <i>Offline</i>
        </span>
        <span *ngIf="recipientPresence !== undefined && recipientPresence !== null && recipientPresence.url === ''"
            class="activity-hidden-span">
            <i>Activity Hidden</i>
        </span>
        <span *ngIf="recipientPresence !== undefined && recipientPresence !== null && recipientPresence.url !== ''"
            class='presence-url-span'>
            <a class="presence-url-a" [href]="recipientPresence.url" target="_blank">
                <i>{{ recipientPresence.domain + ' -' }} {{ recipientPresence.title }}</i>
            </a>
        </span>
    </div>
</div>
<div class='chat-div' #conversationContainer [scrollTop]="scrollTop">
    <div class='load-prev-messages-div' *ngIf="!messagesAllLoaded && !isLoadingMoreMessages">
        <span (click)="loadPreviousMessages()" class='load-prev-messages-span'>
            Load Previous Messages
        </span>
    </div>
    <div *ngIf="isLoadingMoreMessages" style="text-align: center;">
        <span class="spinner-border spinner-border-sm spinner-span" role="status" aria-hidden="true"></span>
    </div>
    <app-chat-message *ngFor="let message of messageArr; let i = index;"
        [message]="message" [currUserId]="currUserId" [senderName]="userNameMap[message.senderId]"
        [senderProfileImgSrc]="userProfileImgUrlMap[message.senderId]" [prevSenderId]="i === 0 ? null : messageArr[i - 1].senderId"
        [nextMessage]="i === messageArr.length - 1 ? null : messageArr[i + 1]" [isSending]="false"
    ></app-chat-message>
    <app-chat-message *ngFor="let message of sendingMessageArr; let i = index;"
        [message]="message" [currUserId]="currUserId" [senderName]="userNameMap[message.senderId]"
        [senderProfileImgSrc]="userProfileImgUrlMap[message.senderId]" [prevSenderId]="i === 0 ? messageArr[messageArr.length - 1]?.senderId : sendingMessageArr[i - 1].senderId"
        [nextMessage]="null" [isSending]="true"
    ></app-chat-message>
</div>
<div class='chat-input-div'>
    <input class='chat-input' [(ngModel)]="newMessageContent" placeholder='Enter message' (keyup.enter)="sendMessage()"/>
    <button (click)="sendMessage()" class='message-send-button'
        [disabled]="newMessageContent === ''">
        <fa-icon [icon]="faPaperPlane" class='fa-icon-send'></fa-icon>
    </button>
</div>